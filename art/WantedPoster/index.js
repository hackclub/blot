const width = 125;
const height = 125;

const scaleX = width / 500;
const scaleY = height / 700;

setDocDimensions(width, height);

const finalLines = [];

const letters = {
  'A': [
    [[0, 1], [0.5, 0]],
    [[0.5, 0], [1, 1]],
    [[0.25, 0.5], [0.75, 0.5]]
  ],
  'B': [
    [[0, 0], [0, 1]],
    [[0, 0], [0.7, 0]],
    [[0.7, 0], [0.9, 0.2]],
    [[0.9, 0.2], [0.7, 0.4]],
    [[0.7, 0.4], [0, 0.4]],
    [[0.7, 0.4], [0.9, 0.6]],
    [[0.9, 0.6], [0.8, 0.8]],
    [[0.8, 0.8], [0.6, 1]],
    [[0.6, 1], [0, 1]]
  ],
  'C': [
    [[0.8, 0.2], [0.4, 0]],
    [[0.4, 0], [0.2, 0.2]],
    [[0.2, 0.2], [0, 0.5]],
    [[0, 0.5], [0.2, 0.8]],
    [[0.2, 0.8], [0.4, 1]],
    [[0.4, 1], [0.8, 0.8]]
  ],
  'D': [
    [[0, 0], [0, 1]],
    [[0, 0], [0.8, 0.2]],
    [[0.8, 0.2], [0.8, 0.8]],
    [[0.8, 0.8], [0, 1]]
  ],
  'E': [
    [[0, 0], [0, 1]],
    [[0, 0], [1, 0]],
    [[0, 0.5], [0.7, 0.5]],
    [[0, 1], [1, 1]]
  ],
  'F': [
    [[0, 0], [0, 1]],
    [[0, 0], [1, 0]],
    [[0, 0.5], [0.7, 0.5]]
  ],
  'G': [
    [[0.8, 0.2], [0.4, 0]],
    [[0.4, 0], [0.2, 0.2]],
    [[0.2, 0.2], [0, 0.5]],
    [[0, 0.5], [0.2, 0.8]],
    [[0.2, 0.8], [0.4, 1]],
    [[0.4, 1], [0.8, 0.8]],
    [[0.8, 0.8], [0.8, 0.5]],
    [[0.8, 0.5], [0.5, 0.5]]
  ],
  'H': [
    [[0, 0], [0, 1]],
    [[1, 0], [1, 1]],
    [[0, 0.5], [1, 0.5]]
  ],
  'I': [
    [[0.5, 0], [0.5, 1]],
    [[0.3, 0], [0.7, 0]],
    [[0.3, 1], [0.7, 1]]
  ],
  'J': [
    [[0, 0], [1, 0]],
    [[0.5, 0], [0.5, 0.8]],
    [[0.5, 0.8], [0.3, 1]],
    [[0.3, 1], [0, 0.8]]
  ],
  'K': [
    [[0, 0], [0, 1]],
    [[0, 0.5], [1, 0]],
    [[0, 0.5], [1, 1]]
  ],
  'L': [
    [[0, 0], [0, 1]],
    [[0, 1], [1, 1]]
  ],
  'M': [
    [[0, 1], [0, 0]],
    [[0, 0], [0.5, 1]],
    [[0.5, 1], [1, 0]],
    [[1, 0], [1, 1]]
  ],
  'N': [ 
    [[0, 1], [0, 0]],
    [[0, 0], [1, 1]],
    [[1, 1], [1, 0]]
  ],
  'O': [
    [[0.5, 0], [0, 0.5]],
    [[0, 0.5], [0.5, 1]],
    [[0.5, 1], [1, 0.5]],
    [[1, 0.5], [0.5, 0]]
  ],
  'P': [
    [[0, 1], [0, 0]],
    [[0, 0], [0.8, 0]],
    [[0.8, 0], [1, 0.2]],
    [[1, 0.2], [0.8, 0.4]],
    [[0.8, 0.4], [0, 0.4]]
  ],
  'Q': [
    [[0.5, 0], [0, 0.5]],
    [[0, 0.5], [0.5, 1]],
    [[0.5, 1], [1, 0.5]],
    [[1, 0.5], [0.5, 0]],
    [[0.7, 0.7], [1, 1]]
  ],
  'R': [
    [[0, 1], [0, 0]],
    [[0, 0], [0.8, 0]],
    [[0.8, 0], [1, 0.2]],
    [[1, 0.2], [0.8, 0.4]],
    [[0.8, 0.4], [0, 0.4]],
    [[0.5, 0.4], [1, 1]]
  ],
  'S': [
    [[1, 0.2], [0.8, 0]],
    [[0.8, 0], [0.2, 0]],
    [[0.2, 0], [0, 0.2]],
    [[0, 0.2], [0.2, 0.4]],
    [[0.2, 0.4], [0.8, 0.6]],
    [[0.8, 0.6], [1, 0.8]],
    [[1, 0.8], [0.8, 1]],
    [[0.8, 1], [0.2, 1]],
    [[0.2, 1], [0, 0.8]]
  ],
  'T': [
    [[0, 0], [1, 0]],
    [[0.5, 0], [0.5, 1]]
  ],
  'U': [
    [[0, 0], [0, 0.8]],
    [[0, 0.8], [0.2, 1]],
    [[0.2, 1], [0.8, 1]],
    [[0.8, 1], [1, 0.8]],
    [[1, 0.8], [1, 0]]
  ],
  'V': [
    [[0, 0], [0.5, 1]],
    [[0.5, 1], [1, 0]]
  ],
  'W': [
    [[0, 0], [0.2, 1]],
    [[0.2, 1], [0.5, 0]],
    [[0.5, 0], [0.8, 1]],
    [[0.8, 1], [1, 0]]
  ],
  'X': [
    [[0, 0], [1, 1]],
    [[0, 1], [1, 0]]
  ],
  'Y': [
    [[0, 0], [0.5, 0.5]],
    [[1, 0], [0.5, 0.5]],
    [[0.5, 0.5], [0.5, 1]]
  ],
  'Z': [
    [[0, 0], [1, 0]],
    [[1, 0], [0, 1]],
    [[0, 1], [1, 1]]
  ],
  ' ': [],
  '0': [
    [[0.5, 0], [0, 0.5]],
    [[0, 0.5], [0.5, 1]],
    [[0.5, 1], [1, 0.5]],
    [[1, 0.5], [0.5, 0]],
    [[0, 0.5], [1, 0.5]]
  ],
  '1': [
    [[0.4, 0.2], [0.5, 0]],
    [[0.5, 0], [0.5, 1]],
    [[0.3, 1], [0.7, 1]]
  ],
  '2': [
    [[0, 0.2], [0.5, 0]],
    [[0.5, 0], [1, 0.2]],
    [[1, 0.2], [0.5, 0.5]],
    [[0.5, 0.5], [0, 0.8]],
    [[0, 0.8], [0, 1]],
    [[0, 1], [1, 1]]
  ],
  '3': [
    [[0, 0.2], [0.5, 0]],
    [[0.5, 0], [1, 0.2]],
    [[1, 0.2], [0.5, 0.5]],
    [[0.5, 0.5], [1, 0.8]],
    [[1, 0.8], [0.5, 1]],
    [[0.5, 1], [0, 0.8]]
  ],
  '4': [
    [[0.8, 0], [0.8, 1]],
    [[0.8, 0], [0, 0.6]],
    [[0, 0.6], [1, 0.6]]
  ],
  '5': [
    [[1, 0], [0, 0]],
    [[0, 0], [0, 0.5]],
    [[0, 0.5], [0.5, 0.5]],
    [[0.5, 0.5], [1, 0.7]],
    [[1, 0.7], [0.5, 1]],
    [[0.5, 1], [0, 0.8]]
  ],
  '6': [
    [[1, 0.2], [0.5, 0]],
    [[0.5, 0], [0, 0.3]],
    [[0, 0.3], [0, 0.7]],
    [[0, 0.7], [0.5, 1]],
    [[0.5, 1], [1, 0.8]],
    [[1, 0.8], [0.5, 0.6]],
    [[0.5, 0.6], [0, 0.7]]
  ],
  '7': [
    [[0, 0], [1, 0]],
    [[1, 0], [0.3, 1]]
  ],
  '8': [
    [[0.5, 0.5], [0, 0.2]],
    [[0, 0.2], [0.5, 0]],
    [[0.5, 0], [1, 0.2]],
    [[1, 0.2], [0.5, 0.5]],
    [[0.5, 0.5], [1, 0.8]],
    [[1, 0.8], [0.5, 1]],
    [[0.5, 1], [0, 0.8]],
    [[0, 0.8], [0.5, 0.5]]
  ],
  '9': [
    [[1, 0.7], [0.5, 1]],
    [[0.5, 1], [0, 0.8]],
    [[0, 0.8], [0.5, 0.6]],
    [[0.5, 0.6], [1, 0.7]],
    [[1, 0.7], [1, 0.3]],
    [[1, 0.3], [0.5, 0]],
    [[0.5, 0], [0, 0.2]]
  ],
  '$': [
    [[0.5, 0], [0.5, 1]],
    [[0.8, 0.2], [0.6, 0.1]],
    [[0.6, 0.1], [0.2, 0.1]],
    [[0.2, 0.1], [0, 0.3]],
    [[0, 0.3], [0.2, 0.5]],
    [[0.2, 0.5], [0.8, 0.5]],
    [[0.8, 0.5], [1, 0.7]],
    [[1, 0.7], [0.8, 0.9]],
    [[0.8, 0.9], [0.4, 0.9]],
    [[0.4, 0.9], [0.2, 0.8]]
  ]
};

function drawLetter(letter, x, y, size) {
  const letterStrokes = letters[letter.toUpperCase()];
  if (!letterStrokes) return;

  letterStrokes.forEach(stroke => {
    const scaledStroke = stroke.map(point => {
      return [x + point[0]*size, y + (1 - point[1])*size];
    });
    finalLines.push(scaledStroke);
  });
}

function drawText(text, x, y, size, letterSpacing) {
  let currentX = x;
  text.split('').forEach(char => {
    if (char === ' ') {
      currentX += size / 2;
    } else {
      drawLetter(char, currentX, y, size);
      currentX += size + letterSpacing;
    }
  });
}

const firstNames = ['JAMES', 'SARAH', 'DAVID', 'CHRIS', 'ALICE', 'EMILY', 'BRIAN', 'OLIVE'];
const lastNames = ['JOHNSON', 'MARTINE', 'GARCIA', 'WILLIAM', 'BROWNIE', 'JACKSON', 'MILLARD', 'ROBISON'];


function getRandomName() {
  const firstName = getRandomElement(firstNames);
  const lastName = getRandomElement(lastNames);
  return `${firstName} ${lastName}`;
}

const bountyMin = 10000;
const bountyMax = 11000;
const bountyRange = bountyMax - bountyMin;
const bounty = Math.floor(bt.rand() * bountyRange) + bountyMin;
const formattedBounty = bounty.toLocaleString('en-US');
const randomName = getRandomName();

drawText('WANTED', 50 * scaleX, 574 * scaleY, 63 * scaleX, 5 * scaleX);
drawText(`REWARD $`, 54 * scaleX, 131 * scaleY, 27 * scaleX, 5 * scaleX);
drawText(randomName, 5 * scaleX, 60 * scaleY, 32 * scaleX, 8 * scaleX);
drawText(String(bounty), 285 * scaleX, 133 * scaleY, 24 * scaleX, 5 * scaleX);

function flipY(y) {
  return height - y;
}

const photoBox = [
  [50 * scaleX, flipY(163 * scaleY)],
  [450 * scaleX, flipY(163 * scaleY)],
  [450 * scaleX, flipY(500 * scaleY)],
  [50 * scaleX, flipY(500 * scaleY)],
  [50 * scaleX, flipY(163 * scaleY)]
];

finalLines.push(photoBox);

const photoBoxX = 50 * scaleX;
const photoBoxY = flipY(500 * scaleY);
const photoBoxWidth = 400 * scaleX;
const photoBoxHeight = 337 * scaleY;

function getRandomElement(array) {
  const randomIndex = Math.floor(bt.rand() * array.length);
  return array[randomIndex];
}


const shirts = [
  [
    [[0.3, 1], [0.7, 1]],
    [[0.7, 1], [0.7, 0.6]],
    [[0.7, 0.6], [0.5, 0.5]],
    [[0.5, 0.5], [0.3, 0.6]],
    [[0.3, 0.6], [0.3, 1]]
  ],
  [
    [[0.3, 1], [0.7, 1]],
    [[0.7, 1], [0.7, 0.5]],
    [[0.7, 0.5], [0.6, 0.5]],
    [[0.6, 0.5], [0.5, 0.6]],
    [[0.5, 0.6], [0.4, 0.5]],
    [[0.4, 0.5], [0.3, 0.5]],
    [[0.3, 0.5], [0.3, 1]]
  ],
  [
    [[0.3, 1], [0.7, 1]],
    [[0.7, 1], [0.7, 0.7]],
    [[0.7, 0.7], [0.3, 0.7]],
    [[0.3, 0.7], [0.3, 1]]
  ]
];

const faces = [
  [
    [[0.5, 0.1], [0.35, 0.2]],
    [[0.35, 0.2], [0.3, 0.35]],
    [[0.3, 0.35], [0.3, 0.55]],
    [[0.3, 0.55], [0.35, 0.7]],
    [[0.35, 0.7], [0.5, 0.8]],
    [[0.5, 0.8], [0.65, 0.7]],
    [[0.65, 0.7], [0.7, 0.55]],
    [[0.7, 0.55], [0.7, 0.35]],
    [[0.7, 0.35], [0.65, 0.2]],
    [[0.65, 0.2], [0.5, 0.1]]
  ],
  [
    [[0.5, 0.1], [0.4, 0.2]],
    [[0.4, 0.2], [0.35, 0.35]],
    [[0.35, 0.35], [0.35, 0.55]],
    [[0.35, 0.55], [0.4, 0.7]],
    [[0.4, 0.7], [0.5, 0.8]],
    [[0.5, 0.8], [0.6, 0.7]],
    [[0.6, 0.7], [0.65, 0.55]],
    [[0.65, 0.55], [0.65, 0.35]],
    [[0.65, 0.35], [0.6, 0.2]],
    [[0.6, 0.2], [0.5, 0.1]]
  ],
  [
    [[0.35, 0.2], [0.65, 0.2]],
    [[0.65, 0.2], [0.65, 0.7]],
    [[0.65, 0.7], [0.35, 0.7]],
    [[0.35, 0.7], [0.35, 0.2]]
  ]
];

const hairs = [
  [
    [[0.35, 0.2], [0.4, 0]],
    [[0.4, 0], [0.45, 0.2]],
    [[0.45, 0.2], [0.5, 0]],
    [[0.5, 0], [0.55, 0.2]],
    [[0.55, 0.2], [0.6, 0]],
    [[0.6, 0], [0.65, 0.2]]
  ],
  [
    [[0.35, 0.2], [0.4, 0.1]],
    [[0.4, 0.1], [0.45, 0.2]],
    [[0.45, 0.2], [0.5, 0.1]],
    [[0.5, 0.1], [0.55, 0.2]],
    [[0.55, 0.2], [0.6, 0.1]],
    [[0.6, 0.1], [0.65, 0.2]]
  ],
  []
];

const eyes = [
  [
    [[0.47, 0.4], [0.49, 0.4]],
    [[0.51, 0.4], [0.53, 0.4]]
  ],
  [
    [[0.42, 0.4], [0.44, 0.4]],
    [[0.56, 0.4], [0.58, 0.4]]
  ],
  [
    [[0.45, 0.4], [0.47, 0.4]],
    [[0.53, 0.4], [0.55, 0.4]]
  ]
];

const facialHairs = [
  [
    [[0.46, 0.5], [0.54, 0.5]]
  ],
  [
    [[0.4, 0.55], [0.6, 0.55]],
    [[0.6, 0.55], [0.6, 0.7]],
    [[0.6, 0.7], [0.4, 0.7]],
    [[0.4, 0.7], [0.4, 0.55]]
  ],
  [
    [[0.48, 0.6], [0.52, 0.6]],
    [[0.52, 0.6], [0.52, 0.7]],
    [[0.52, 0.7], [0.48, 0.7]],
    [[0.48, 0.7], [0.48, 0.6]]
  ],
  []
];

const selectedShirt = getRandomElement(shirts);
const selectedFace = getRandomElement(faces);
const selectedHair = getRandomElement(hairs);
const selectedEyes = getRandomElement(eyes);
const selectedFacialHair = getRandomElement(facialHairs);

function drawFeature(featureLines) {
  featureLines.forEach(stroke => {
    const scaledStroke = stroke.map(point => {
      return [
        photoBoxX + point[0] * photoBoxWidth,
        photoBoxY + (1 - point[1]) * photoBoxHeight
      ];
    });
    finalLines.push(scaledStroke);
  });
}

drawFeature(selectedShirt);
drawFeature(selectedFace);
drawFeature(selectedHair);
drawFeature(selectedEyes);
drawFeature(selectedFacialHair);

drawLines(finalLines);