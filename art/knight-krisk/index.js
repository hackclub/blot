/*
@title: knight
@author: krisk
@snapshot: img2.png
*/
const ty = Math.PI*2/8 // theta-y; controls rotation
const f = 3 // focal length
const normal_inversion = true // the normals may have to be inverted
const useHatching = true // stippling is much much slower, check the console for progress
const hatchingLinesUp = false // makes hatching line up; reduces the number of colors to only powers of two
const light = [2, 10, -1] // lighting direction
// you can also change the verts, norms, and faces with the following link (upload an obj in place of the standford-bunny file): https://replit.com/@KrishnaKesavalu/obj2list

const width = 125;
const height = 125;

setDocDimensions(width, height);

// thanks to sebastian lague for such a cute and low poly model
let verts = [[28.14545631408691, 51.27168655395508, 67.95145416259766], [0.0, 51.27168655395508, 79.61009216308594], [0.0, 31.78059005737305, 77.00394439697266], [27.22404098510742, 31.78058815002441, 65.72696685791016], [0.0, 145.3078460693359, 64.77812194824219], [15.48893165588379, 145.3078460693359, 64.77812194824219], [16.91339683532715, 167.8968811035156, 47.74495315551758], [0.0, 167.8968811035156, 47.74495315551758], [0.0, 23.24704170227051, -79.46662139892578], [0.0, 26.39448738098145, -72.89425659179688], [51.54208374023438, 26.39449119567871, -51.54401016235352], [55.84377670288086, 23.24704551696777, -56.21702575683594], [79.0933837890625, 23.24705505371094, -0.08752426505088806], [72.89232635498047, 26.39449882507324, -4.300209639040986e-06], [55.84377670288086, 23.2470645904541, 56.04197692871094], [51.54208374023438, 26.39450645446777, 51.54400253295898], [78.34032440185547, 8.015108108520508, 0.5618365406990051], [55.47497940063477, 8.015117645263672, 55.76366806030273], [55.47497940063477, 8.01509952545166, -54.63999557495117], [0.0, 8.015095710754395, -77.5053482055664], [28.6262092590332, 8.015118598937988, 67.19634246826172], [27.77999305725098, 23.24706649780273, 67.66677856445312], [0.0, 23.24706840515137, 79.29158020019531], [0.0, 8.015120506286621, 78.62902069091797], [77.00202941894531, 31.78057670593262, -5.192222033656435e-06], [79.60818481445312, 51.27167510986328, -8.353216799150687e-06], [56.29091262817383, 51.27168273925781, 56.29282379150391], [54.44808197021484, 31.78058624267578, 54.44999694824219], [0.0, 51.27166366577148, -79.610107421875], [56.29091262817383, 51.27166748046875, -56.29283905029297], [54.44808197021484, 31.78056716918945, -54.45000457763672], [0.0, 31.78056335449219, -77.00395965576172], [25.77104187011719, 26.39450836181641, 62.21912002563477], [0.0, 26.39451026916504, 72.89424133300781], [61.17996597290039, 65.41106414794922, -8.87681198946666e-06], [45.64182662963867, 65.41107177734375, 39.81670379638672], [22.82091331481934, 65.41107177734375, 48.06301498413086], [0.0, 65.41105651855469, -56.30935287475586], [45.64182662963867, 65.41105651855469, -39.81672668457031], [0.0, 166.3777160644531, -77.760986328125], [0.0, 210.2197265625, -82.95497131347656], [21.64529418945312, 210.1767425537109, -71.61286926269531], [24.47286415100098, 166.5804138183594, -64.86416625976562], [28.37571144104004, 167.2427825927734, 29.4931468963623], [39.12450790405273, 165.9477081298828, -12.15004444122314], [30.87564659118652, 209.7042846679688, -28.31289291381836], [22.18839645385742, 213.1782531738281, 4.675389289855957], [0.0, 259.5027160644531, -76.42721557617188], [0.0, 302.5391540527344, -44.76200485229492], [31.26542854309082, 302.5391540527344, -35.68589019775391], [24.17706108093262, 258.0330505371094, -64.96621704101562], [26.77075958251953, 232.5023345947266, 2.759787797927856], [30.30008888244629, 246.2603302001953, -32.45878982543945], [31.27908325195312, 272.8711242675781, -7.82640552520752], [29.65088844299316, 251.1347808837891, 9.216723442077637], [20.35306167602539, 217.3495788574219, 20.28698348999023], [0.0, 216.5496520996094, 21.0733699798584], [0.0, 210.4873657226562, 10.35479640960693], [26.15125846862793, 232.0387115478516, 21.88065910339355], [23.81523895263672, 311.4834899902344, 23.69853782653809], [26.0757884979248, 316.8746948242188, 3.791981220245361], [0.0, 318.2948913574219, 4.681901931762695], [0.0, 314.2062377929688, 25.9747142791748], [23.87700653076172, 242.7855834960938, 54.75618743896484], [25.31877136230469, 261.9187622070312, 45.58769607543945], [16.09400367736816, 259.3988952636719, 89.49881744384766], [16.9187183380127, 234.3358612060547, 83.67742919921875], [28.87252616882324, 305.3869323730469, -6.165623188018799], [23.14436149597168, 285.6111755371094, 50.17289733886719], [26.90540313720703, 278.6412048339844, 27.12013244628906], [16.48407745361328, 221.9061126708984, 50.33324432373047], [16.44344711303711, 213.8877563476562, 64.34088897705078], [0.0, 213.0675048828125, 64.9931411743164], [0.0, 221.0858459472656, 50.98550033569336], [0.0, 285.89599609375, 50.11365509033203], [0.0, 259.8090209960938, 91.77499389648438], [0.0, 234.1307983398438, 85.14164733886719], [42.15329360961914, 93.24549102783203, -43.3694953918457], [42.38912963867188, 98.24186706542969, -44.85836791992188], [60.97007369995117, 98.24187469482422, -1.408292155247182e-05], [60.11753082275391, 93.24549865722656, -1.338033780484693e-05], [21.07664680480957, 93.2455062866211, 52.35158538818359], [42.15329360961914, 93.2455062866211, 43.36946487426758], [42.38912963867188, 98.24188232421875, 44.85833740234375], [21.19456481933594, 98.24188232421875, 54.1488151550293], [0.0, 93.24549102783203, -61.33373260498047], [0.0, 98.24186706542969, -63.43931198120117], [34.47707366943359, 144.6495819091797, -58.27033233642578], [46.5919303894043, 144.3262023925781, -8.809700965881348], [37.33842849731445, 144.5079498291016, 41.42189788818359], [0.0, 144.5482482910156, -75.92491149902344], [17.17983055114746, 330.8393249511719, -16.31320953369141], [31.14883613586426, 330.0204467773438, -13.54980182647705], [18.84247970581055, 336.9612426757812, 5.930622100830078], [25.3868408203125, 336.6843566894531, 6.575994491577148], [51.99399566650391, 79.68331146240234, -1.152571985585382e-05], [37.53822326660156, 79.68331909179688, 35.40249633789062], [0.0, 79.68330383300781, -50.06672286987305], [37.53822326660156, 79.68330383300781, -35.40251922607422], [18.76911163330078, 79.68331909179688, 42.73459625244141], [58.51276397705078, 119.1603775024414, -7.911022186279297], [49.87014770507812, 119.0769882202148, 46.23004531860352], [35.15639114379883, 108.6705169677734, 30.51278686523438], [44.46456909179688, 108.9319076538086, -3.780401229858398], [36.07192993164062, 108.9319000244141, -30.33373832702637], [46.47761154174805, 119.1603698730469, -49.67636489868164], [17.57819557189941, 108.8012161254883, 36.87611770629883], [0.0, 108.9319000244141, -42.87493133544922], [0.0, 119.1603622436523, -71.22224426269531], [14.01382350921631, 119.1316757202148, 75.06097412109375], [51.31661224365234, 89.40897369384766, -1.305785099248169e-05], [36.32896423339844, 89.40898132324219, 36.18334197998047], [0.0, 89.40896606445312, -51.17101287841797], [36.32896423339844, 89.40896606445312, -36.18337249755859], [18.16448211669922, 89.40898132324219, 43.67716217041016], [54.52749252319336, 1.243483901023865, -51.80913162231445], [76.2436752319336, 1.243492484092712, 0.618346631526947], [73.97052001953125, -0.2769427299499512, 0.6183468699455261], [52.89225769042969, -0.276951014995575, -50.26906204223633], [28.26708030700684, 1.243502736091614, 63.90392303466797], [0.0, 1.243504524230957, 74.76200866699219], [0.0, -0.2769309878349304, 72.58401489257812], [27.44946098327637, -0.2769327163696289, 62.04488372802734], [0.0, 1.243480443954468, -73.52531433105469], [0.0, -0.2769544422626495, -71.34732055664062], [54.52749252319336, 1.243500947952271, 53.04582595825195], [52.89225769042969, -0.276934415102005, 51.5057487487793], [0.0, 122.7187728881836, -74.0888442993164], [47.84836578369141, 122.7187805175781, -51.676513671875], [52.12548828125, 122.6878356933594, 46.77011871337891], [59.97011184692383, 122.7187881469727, -8.819602966308594], [0.0, 122.7188034057617, 79.49158477783203], [14.06446552276611, 122.7188034057617, 79.49158477783203], [0.0, 89.40898132324219, 51.17098236083984], [0.0, 93.2455062866211, 61.33370208740234], [0.0, 79.68331909179688, 50.06669998168945], [0.0, 119.1603927612305, 76.45946502685547], [0.0, 98.24188232421875, 63.43928146362305], [0.0, 108.9319152832031, 43.23945236206055], [0.0, 65.41107177734375, 56.30932998657227], [-28.14545631408691, 51.27168655395508, 67.95145416259766], [-27.22404098510742, 31.78058815002441, 65.72696685791016], [-16.91339683532715, 167.8968811035156, 47.74495315551758], [-15.48893165588379, 145.3078460693359, 64.77812194824219], [-55.84377670288086, 23.24704551696777, -56.21702575683594], [-51.54208374023438, 26.39449119567871, -51.54401016235352], [-79.0933837890625, 23.24705505371094, -0.08752426505088806], [-72.89232635498047, 26.39449882507324, -4.300209639040986e-06], [-55.84377670288086, 23.2470645904541, 56.04197692871094], [-51.54208374023438, 26.39450645446777, 51.54400253295898], [-78.34032440185547, 8.015108108520508, 0.5618365406990051], [-55.47497940063477, 8.015117645263672, 55.76366806030273], [-55.47497940063477, 8.01509952545166, -54.63999557495117], [-28.6262092590332, 8.015118598937988, 67.19634246826172], [-27.77999305725098, 23.24706649780273, 67.66677856445312], [-77.00202941894531, 31.78057670593262, -5.192222033656435e-06], [-54.44808197021484, 31.78058624267578, 54.44999694824219], [-56.29091262817383, 51.27168273925781, 56.29282379150391], [-79.60818481445312, 51.27167510986328, -8.353216799150687e-06], [-54.44808197021484, 31.78056716918945, -54.45000457763672], [-56.29091262817383, 51.27166748046875, -56.29283905029297], [-25.77104187011719, 26.39450836181641, 62.21912002563477], [-45.64182662963867, 65.41107177734375, 39.81670379638672], [-61.17996597290039, 65.41106414794922, -8.87681198946666e-06], [-22.82091331481934, 65.41107177734375, 48.06301498413086], [-45.64182662963867, 65.41105651855469, -39.81672668457031], [-24.47286415100098, 166.5804138183594, -64.86416625976562], [-21.64529418945312, 210.1767425537109, -71.61286926269531], [-28.37571144104004, 167.2427825927734, 29.4931468963623], [-22.18839645385742, 213.1782531738281, 4.675389289855957], [-30.87564659118652, 209.7042846679688, -28.31289291381836], [-39.12450790405273, 165.9477081298828, -12.15004444122314], [-24.17706108093262, 258.0330505371094, -64.96621704101562], [-31.26542854309082, 302.5391540527344, -35.68589019775391], [-26.77075958251953, 232.5023345947266, 2.759787797927856], [-29.65088844299316, 251.1347808837891, 9.216723442077637], [-31.27908325195312, 272.8711242675781, -7.82640552520752], [-30.30008888244629, 246.2603302001953, -32.45878982543945], [-20.35306167602539, 217.3495788574219, 20.28698348999023], [-26.15125846862793, 232.0387115478516, 21.88065910339355], [-23.81523895263672, 311.4834899902344, 23.69853782653809], [-26.0757884979248, 316.8746948242188, 3.791981220245361], [-23.87700653076172, 242.7855834960938, 54.75618743896484], [-16.9187183380127, 234.3358612060547, 83.67742919921875], [-16.09400367736816, 259.3988952636719, 89.49881744384766], [-25.31877136230469, 261.9187622070312, 45.58769607543945], [-28.87252616882324, 305.3869323730469, -6.165623188018799], [-26.90540313720703, 278.6412048339844, 27.12013244628906], [-23.14436149597168, 285.6111755371094, 50.17289733886719], [-16.48407745361328, 221.9061126708984, 50.33324432373047], [-16.44344711303711, 213.8877563476562, 64.34088897705078], [-42.15329360961914, 93.24549102783203, -43.3694953918457], [-60.11753082275391, 93.24549865722656, -1.338033780484693e-05], [-60.97007369995117, 98.24187469482422, -1.408292155247182e-05], [-42.38912963867188, 98.24186706542969, -44.85836791992188], [-21.07664680480957, 93.2455062866211, 52.35158538818359], [-21.19456481933594, 98.24188232421875, 54.1488151550293], [-42.38912963867188, 98.24188232421875, 44.85833740234375], [-42.15329360961914, 93.2455062866211, 43.36946487426758], [-34.47707366943359, 144.6495819091797, -58.27033233642578], [-46.5919303894043, 144.3262023925781, -8.809700965881348], [-37.33842849731445, 144.5079498291016, 41.42189788818359], [-31.14883613586426, 330.0204467773438, -13.54980182647705], [-17.17983055114746, 330.8393249511719, -16.31320953369141], [-18.84247970581055, 336.9612426757812, 5.930622100830078], [-25.3868408203125, 336.6843566894531, 6.575994491577148], [-37.53822326660156, 79.68331909179688, 35.40249633789062], [-51.99399566650391, 79.68331146240234, -1.152571985585382e-05], [-37.53822326660156, 79.68330383300781, -35.40251922607422], [-18.76911163330078, 79.68331909179688, 42.73459625244141], [-58.51276397705078, 119.1603775024414, -7.911022186279297], [-44.46456909179688, 108.9319076538086, -3.780401229858398], [-35.15639114379883, 108.6705169677734, 30.51278686523438], [-49.87014770507812, 119.0769882202148, 46.23004531860352], [-46.47761154174805, 119.1603698730469, -49.67636489868164], [-36.07192993164062, 108.9319000244141, -30.33373832702637], [-17.57819557189941, 108.8012161254883, 36.87611770629883], [-14.01382350921631, 119.1316757202148, 75.06097412109375], [-36.32896423339844, 89.40898132324219, 36.18334197998047], [-51.31661224365234, 89.40897369384766, -1.305785099248169e-05], [-36.32896423339844, 89.40896606445312, -36.18337249755859], [-18.16448211669922, 89.40898132324219, 43.67716217041016], [-54.52749252319336, 1.243483901023865, -51.80913162231445], [-52.89225769042969, -0.276951014995575, -50.26906204223633], [-73.97052001953125, -0.2769427299499512, 0.6183468699455261], [-76.2436752319336, 1.243492484092712, 0.618346631526947], [-28.26708030700684, 1.243502736091614, 63.90392303466797], [-27.44946098327637, -0.2769327163696289, 62.04488372802734], [-52.89225769042969, -0.276934415102005, 51.5057487487793], [-54.52749252319336, 1.243500947952271, 53.04582595825195], [-47.84836578369141, 122.7187805175781, -51.676513671875], [-52.12548828125, 122.6878356933594, 46.77011871337891], [-59.97011184692383, 122.7187881469727, -8.819602966308594], [-14.06446552276611, 122.7188034057617, 79.49158477783203]]
let norms = [[37.98080825805664, -12.25993728637695, 91.69051361083984], [0.0, 60.20653915405273, 79.84468841552734], [17.77676582336426, 88.61125946044922, -42.80221939086914], [44.28619003295898, 87.76236724853516, -18.3439769744873], [44.68572235107422, 87.5247573852539, 18.50945281982422], [92.34814453125, -2.934869766235352, 38.25185394287109], [92.21094512939453, -6.187134742736816, -38.19502258300781], [38.03448867797852, -11.12429809570312, -91.81300354003906], [37.82746505737305, -2.390871524810791, 92.53846740722656], [91.69098663330078, -12.2600040435791, 37.97968673706055], [37.98080444335938, -12.26004219055176, -91.69051361083984], [18.20555686950684, 88.07511138916016, 43.71879959106445], [91.69097900390625, -12.2600154876709, -37.97967910766602], [60.18639373779297, 76.0627212524414, 24.33229827880859], [21.1118049621582, 81.43822479248047, 54.0565185546875], [20.68051147460938, 82.27018737792969, -52.95219039916992], [60.18641662597656, 76.06269836425781, -24.33231544494629], [46.2940673828125, -10.52400016784668, -88.01195526123047], [93.94515991210938, 25.55317306518555, 22.83294486999512], [96.8853759765625, 5.982429981231689, -24.02983283996582], [30.74977684020996, 52.67789840698242, -79.24324035644531], [99.42156982421875, -10.3787727355957, 2.762663125991821], [99.28205108642578, -2.375188827514648, -11.72318649291992], [13.13528156280518, -92.08734130859375, 36.70674133300781], [98.63631439208984, -16.218017578125, 2.802526712417603], [9.49448299407959, 96.89810943603516, 22.81690406799316], [97.60982513427734, 0.282964676618576, 21.73112106323242], [98.46819305419922, 10.69929885864258, 13.76730442047119], [98.09473419189453, 5.390662670135498, 18.66455459594727], [2.355180978775024, -86.7643814086914, -49.66281127929688], [7.797110080718994, 68.00337982177734, 72.90231323242188], [4.56065845489502, 83.73750305175781, 54.4723014831543], [10.79761600494385, -23.53304481506348, 96.58989715576172], [91.26092529296875, -15.5721321105957, -37.80149841308594], [37.83562469482422, -30.12277030944824, 87.52762603759766], [37.57180023193359, -32.15154266357422, -86.91741943359375], [91.26092529296875, -15.57211780548096, 37.8015022277832], [97.943359375, -1.67410135269165, -20.10704040527344], [98.43268585205078, -5.231112003326416, 16.84163856506348], [44.57532501220703, 10.88852691650391, -88.85087585449219], [91.90104675292969, 31.44307327270508, -23.78091812133789], [89.78397369384766, 39.76593017578125, 18.90790367126465], [45.94113922119141, -6.561038017272949, -88.57970428466797], [20.8953800201416, 62.10862350463867, -75.53742980957031], [98.29817199707031, 11.54505252838135, 14.28924942016602], [-71.84638214111328, 66.97512817382812, -18.77313423156738], [96.091064453125, -0.5669830441474915, 27.6800422668457], [0.1983710825443268, -10.51662254333496, 99.44526672363281], [99.40394592285156, -6.5799880027771, 8.69240665435791], [4.93805456161499, -98.70121765136719, 15.28669738769531], [99.29999542236328, 2.38141655921936, 11.56886196136475], [99.31017303466797, 6.864591598510742, 9.50615119934082], [99.1465072631836, -6.295545101165771, 11.41640567779541], [91.22666931152344, -36.85565185546875, 17.87051582336426], [6.698436260223389, -68.80552673339844, 72.2560043334961], [97.14585876464844, -22.61347007751465, 7.163361549377441], [95.20840454101562, -28.96388816833496, 9.821069717407227], [79.3061294555664, 36.87662124633789, 48.4835319519043], [78.94876861572266, 52.68808364868164, 31.48105049133301], [31.99713516235352, 40.97587203979492, -85.42342376708984], [31.75783538818359, 42.46194839477539, 84.7845687866211], [78.9487533569336, 52.68810653686523, -31.48109436035156], [55.02761077880859, -82.79073333740234, 10.84697723388672], [53.78895950317383, -82.75310516357422, -16.08327102661133], [20.17609977722168, 84.6502456665039, 49.26725387573242], [14.95039463043213, -92.00885772705078, -36.20573425292969], [20.39194107055664, -92.70995330810547, 31.44889831542969], [56.13131713867188, 80.29663848876953, 20.0430908203125], [60.59537506103516, 76.18619537353516, -22.88808441162109], [92.22773742675781, 7.422665596008301, 37.93349075317383], [37.16994094848633, -6.66321325302124, -92.59588623046875], [37.2108154296875, -4.7431640625, 92.69766998291016], [92.2277603149414, 7.422651767730713, -37.93343353271484], [54.17842864990234, -81.00048828125, -22.44143104553223], [21.4857234954834, -80.05184173583984, 55.94699859619141], [22.18913078308105, -80.03382110595703, -55.69765472412109], [54.17844772338867, -81.00048065185547, 22.44146347045898], [19.24223327636719, 85.30191040039062, -48.51103591918945], [6.093863964080811, 67.20690155029297, 73.79768371582031], [69.9435043334961, 46.37966537475586, 54.37675476074219], [43.7311897277832, -3.945042133331299, -89.84442138671875], [82.41059875488281, 55.07516479492188, 13.2370433807373], [84.56108093261719, 48.62208938598633, -22.02993011474609], [0.0, 54.57860565185547, 83.79244995117188], [39.4240837097168, -90.438232421875, 16.33002853393555], [15.00354290008545, -92.18434143066406, -35.73430633544922], [15.17640686035156, -91.99532318115234, 36.14605331420898], [39.424072265625, -90.438232421875, -16.32999801635742], [75.5114517211914, -57.61696243286133, 31.27789497375488], [75.5114517211914, -57.61696624755859, -31.27787399291992], [31.27887344360352, -57.61688995361328, 75.51109313964844], [31.27884292602539, -57.61696624755859, -75.51104736328125], [9.73775577545166, 95.53758239746094, -27.88810539245605], [32.60409545898438, -44.85559844970703, 83.21627044677734], [33.69739532470703, -44.171875, -83.14643859863281], [88.7498779296875, -27.7859058380127, -36.76140975952148], [88.89988708496094, -27.21829223632812, 36.82355499267578], [35.33787155151367, -40.77356338500977, 84.19471740722656], [31.27883338928223, -57.61698532104492, 75.51103973388672], [14.83423519134521, -92.36698150634766, 35.33109664916992], [22.85608291625977, -80.17124938964844, 55.22834014892578], [37.11548614501953, -8.575827598571777, 92.46023559570312], [3.368229866027832, -72.19941711425781, 69.10787963867188], [19.26199722290039, 86.14441680908203, 46.9905891418457], [32.23123931884766, 39.45650863647461, 86.04843139648438], [37.29504776000977, -34.13681793212891, 86.27720642089844], [20.26247024536133, 83.0524673461914, 51.88178634643555], [18.24870491027832, 87.89864349365234, 44.05465316772461], [38.70964431762695, -1.6591637134552, 92.18899536132812], [37.98079299926758, -12.26003742218018, 91.69051361083984], [60.60460662841797, 47.16923522949219, 64.04798889160156], [6.372608184814453, -95.81584167480469, 27.90544319152832], [51.50123977661133, -59.26537704467773, 61.92927932739258], [34.58556365966797, -57.41177749633789, -74.21406555175781], [86.20227813720703, -44.312744140625, -24.60788536071777], [88.29586029052734, -45.04533767700195, 13.21959972381592], [-37.98081207275391, -12.25993728637695, 91.69051361083984], [-17.77677154541016, 88.61125946044922, -42.80223083496094], [-44.28619003295898, 87.76235961914062, -18.34397888183594], [-44.68573379516602, 87.5247573852539, 18.50945281982422], [-92.34815979003906, -2.934870004653931, 38.25185775756836], [-92.21094512939453, -6.187134265899658, -38.19502258300781], [-38.03448867797852, -11.12428760528564, -91.81300354003906], [-37.82746124267578, -2.390871524810791, 92.53846740722656], [-91.69097900390625, -12.2600040435791, 37.97968292236328], [-37.98080825805664, -12.26003837585449, -91.69051361083984], [-18.20555686950684, 88.07511138916016, 43.71879959106445], [-91.69097900390625, -12.2600154876709, -37.97967910766602], [-60.18638610839844, 76.0627212524414, 24.33229827880859], [-21.1118049621582, 81.438232421875, 54.0565185546875], [-20.68051147460938, 82.27018737792969, -52.95219039916992], [-60.18640899658203, 76.06269836425781, -24.33231544494629], [-46.2940673828125, -10.5239953994751, -88.01195526123047], [-93.94515991210938, 25.55317306518555, 22.83294105529785], [-96.8853759765625, 5.982428550720215, -24.02983283996582], [-30.74977684020996, 52.67789459228516, -79.24324035644531], [-99.42156982421875, -10.37877655029297, 2.762664079666138], [-99.28205108642578, -2.375189065933228, -11.72318649291992], [-13.13527393341064, -92.08734130859375, 36.70674133300781], [-98.63631439208984, -16.218017578125, 2.802526712417603], [-9.494440078735352, 96.89810943603516, 22.81690406799316], [-97.60983276367188, 0.2829639911651611, 21.73111152648926], [-98.46819305419922, 10.69929885864258, 13.76730346679688], [-98.09473419189453, 5.390660285949707, 18.66455078125], [-2.355191469192505, -86.7643814086914, -49.66281127929688], [-7.797107219696045, 68.00337982177734, 72.90231323242188], [-4.560718536376953, 83.73750305175781, 54.4723014831543], [-10.79761600494385, -23.53304481506348, 96.58989715576172], [-91.26092529296875, -15.57212924957275, -37.80149459838867], [-37.83561325073242, -30.12274742126465, 87.52762603759766], [-37.57180404663086, -32.15154266357422, -86.91741943359375], [-91.26093292236328, -15.57211780548096, 37.8015022277832], [-97.943359375, -1.674100995063782, -20.10704040527344], [-98.43268585205078, -5.231112003326416, 16.84164047241211], [-44.57532501220703, 10.88852691650391, -88.85088348388672], [-91.90104675292969, 31.44306373596191, -23.78090858459473], [-89.78398132324219, 39.76592254638672, 18.90789604187012], [-45.94113922119141, -6.561027526855469, -88.57970428466797], [-20.8953800201416, 62.10862350463867, -75.53742218017578], [-98.29817199707031, 11.54505252838135, 14.28924942016602], [71.84638214111328, 66.97512817382812, -18.77313423156738], [-96.091064453125, -0.5669829845428467, 27.68003845214844], [-0.198371097445488, -10.51662445068359, 99.44527435302734], [-99.40394592285156, -6.5799880027771, 8.69240665435791], [-4.938057899475098, -98.70121765136719, 15.28669738769531], [-99.29999542236328, 2.38141655921936, 11.56886196136475], [-99.31017303466797, 6.864595890045166, 9.506155967712402], [-99.1465072631836, -6.295545101165771, 11.41640567779541], [-91.22666931152344, -36.85564804077148, 17.87051010131836], [-6.698442935943604, -68.8055191040039, 72.25599670410156], [-97.14585876464844, -22.61346626281738, 7.163361549377441], [-95.20840454101562, -28.96389198303223, 9.821072578430176], [-79.3061294555664, 36.87662124633789, 48.4835319519043], [-78.94876861572266, 52.68808364868164, 31.48105049133301], [-31.99712944030762, 40.97587203979492, -85.42342376708984], [-31.75783538818359, 42.46194839477539, 84.7845687866211], [-78.94874572753906, 52.68810653686523, -31.48109436035156], [-55.02761077880859, -82.79074096679688, 10.84698009490967], [-53.78895950317383, -82.75311279296875, -16.08327102661133], [-20.17609786987305, 84.6502456665039, 49.26725006103516], [-14.95039463043213, -92.00885772705078, -36.20573425292969], [-20.3919506072998, -92.70995330810547, 31.44889831542969], [-56.13130950927734, 80.29663848876953, 20.04308700561523], [-60.59539413452148, 76.18619537353516, -22.88808441162109], [-92.22773742675781, 7.422665596008301, 37.93349075317383], [-37.1699333190918, -6.66321325302124, -92.59588623046875], [-37.21081161499023, -4.743166446685791, 92.69766998291016], [-92.2277603149414, 7.422651767730713, -37.93343353271484], [-54.17844009399414, -81.00048828125, -22.44143676757812], [-21.4857234954834, -80.05184173583984, 55.94699859619141], [-22.18914985656738, -80.03379821777344, -55.69770812988281], [-54.17842864990234, -81.00048065185547, 22.44145584106445], [-19.24223327636719, 85.30191040039062, -48.51103591918945], [-6.093876838684082, 67.20690155029297, 73.79768371582031], [-69.9435043334961, 46.37967681884766, 54.37676620483398], [-43.73119354248047, -3.94504189491272, -89.84441375732422], [-82.41059875488281, 55.07516479492188, 13.23704147338867], [-84.56108093261719, 48.62208938598633, -22.02992820739746], [0.0, 54.57859802246094, 83.79246520996094], [-39.42408752441406, -90.438232421875, 16.33002853393555], [-15.00356006622314, -92.18434143066406, -35.73430633544922], [-15.17640781402588, -91.99532318115234, 36.14605712890625], [-39.4240837097168, -90.438232421875, -16.32999801635742], [-75.5114517211914, -57.61695861816406, 31.27789306640625], [-75.5114517211914, -57.61697006225586, -31.27787590026855], [-31.27887535095215, -57.61688995361328, 75.51109313964844], [-31.27883911132812, -57.61696624755859, -75.51104736328125], [-9.737643241882324, 95.53759765625, -27.88810539245605], [-32.60409545898438, -44.85559844970703, 83.21627044677734], [-33.6973991394043, -44.17185592651367, -83.14644622802734], [-88.7498779296875, -27.78590202331543, -36.76140975952148], [-88.89988708496094, -27.21829223632812, 36.82355880737305], [-35.33787155151367, -40.7735595703125, 84.19471740722656], [-31.27883338928223, -57.61700439453125, 75.51103210449219], [-14.83423137664795, -92.36697387695312, 35.33108901977539], [-22.85609245300293, -80.17123413085938, 55.22836303710938], [-37.11548614501953, -8.57583999633789, 92.46023559570312], [-3.368229150772095, -72.19943237304688, 69.10787200927734], [-19.26198387145996, 86.14441680908203, 46.99059677124023], [-32.23123931884766, 39.45650863647461, 86.04843139648438], [-37.29506301879883, -34.13681030273438, 86.27720642089844], [-20.26247406005859, 83.0524673461914, 51.88178634643555], [-18.24869346618652, 87.8986587524414, 44.05464172363281], [-38.70964431762695, -1.65917706489563, 92.18899536132812], [-37.98079681396484, -12.26002979278564, 91.69051361083984], [-60.6046028137207, 47.16924667358398, 64.0479965209961], [-6.372617721557617, -95.81584167480469, 27.90544319152832], [-51.5012092590332, -59.26540374755859, 61.92929077148438], [-34.58552169799805, -57.41178512573242, -74.21407318115234], [-86.20226287841797, -44.31276702880859, -24.6079044342041], [-88.29583740234375, -45.04537582397461, 13.2196102142334]]
let faces = [[52, 55, 59, 25], [68, 61, 60, 45], [50, 93, 68, 49], [7, 44, 47, 58], [175, 180, 176, 140], [187, 181, 182, 160], [174, 187, 203, 164], [143, 170, 169, 173], [1, 2, 3, 1], [3, 4, 1, 1], [5, 6, 7, 2], [7, 8, 5, 2], [9, 10, 11, 3], [11, 12, 9, 3], [13, 12, 11, 4], [11, 14, 13, 4], [15, 13, 14, 5], [14, 16, 15, 5], [17, 13, 15, 6], [15, 18, 17, 6], [19, 12, 13, 7], [13, 17, 19, 7], [20, 9, 12, 8], [12, 19, 20, 8], [21, 22, 23, 9], [23, 24, 21, 9], [25, 26, 27, 10], [27, 28, 25, 10], [29, 30, 31, 11], [31, 32, 29, 11], [22, 33, 34, 12], [34, 23, 22, 12], [30, 26, 25, 13], [25, 31, 30, 13], [27, 26, 35, 14], [35, 36, 27, 14], [1, 27, 36, 15], [36, 37, 1, 15], [30, 29, 38, 16], [38, 39, 30, 16], [30, 39, 35, 17], [35, 26, 30, 17], [40, 41, 42, 18], [42, 43, 40, 18], [44, 45, 46, 19], [46, 47, 44, 19], [43, 42, 46, 20], [46, 45, 43, 20], [48, 49, 50, 21], [50, 51, 48, 21], [52, 53, 54, 22], [54, 55, 52, 22], [51, 50, 54, 23], [54, 53, 51, 23], [47, 56, 57, 24], [57, 58, 47, 24], [60, 61, 62, 26], [62, 63, 60, 26], [64, 65, 66, 27], [66, 67, 64, 27], [68, 60, 69, 28], [69, 70, 68, 28], [65, 70, 69, 29], [69, 66, 65, 29], [71, 72, 73, 30], [73, 74, 71, 30], [60, 63, 75, 31], [75, 69, 60, 31], [66, 69, 75, 32], [75, 76, 66, 32], [67, 66, 76, 33], [76, 77, 67, 33], [78, 79, 80, 34], [80, 81, 78, 34], [82, 83, 84, 35], [84, 85, 82, 35], [78, 86, 87, 36], [87, 79, 78, 36], [83, 81, 80, 37], [80, 84, 83, 37], [42, 51, 53, 38], [53, 46, 42, 38], [47, 46, 53, 39], [53, 52, 47, 39], [41, 48, 51, 40], [51, 42, 41, 40], [88, 43, 45, 41], [45, 89, 88, 41], [90, 89, 45, 42], [45, 44, 90, 42], [91, 40, 43, 43], [43, 88, 91, 43], [49, 92, 93, 44], [93, 50, 49, 44], [49, 62, 94, 46], [94, 92, 49, 46], [68, 93, 95, 47], [95, 61, 68, 47], [61, 95, 94, 48], [94, 62, 61, 48], [56, 71, 74, 50], [74, 57, 56, 50], [55, 54, 70, 51], [70, 65, 55, 51], [50, 68, 70, 52], [70, 54, 50, 52], [59, 55, 65, 53], [65, 64, 59, 53], [56, 59, 64, 54], [64, 71, 56, 54], [72, 67, 77, 55], [77, 73, 72, 55], [71, 64, 67, 56], [67, 72, 71, 56], [47, 52, 59, 57], [59, 56, 47, 57], [36, 35, 96, 59], [96, 97, 36, 59], [39, 38, 98, 60], [98, 99, 39, 60], [37, 36, 97, 61], [97, 100, 37, 61], [39, 99, 96, 62], [96, 35, 39, 62], [101, 102, 103, 63], [103, 104, 101, 63], [101, 104, 105, 64], [105, 106, 101, 64], [85, 84, 103, 65], [103, 107, 85, 65], [106, 105, 108, 66], [108, 109, 106, 66], [102, 110, 107, 67], [107, 103, 102, 67], [84, 80, 104, 68], [104, 103, 84, 68], [80, 79, 105, 69], [105, 104, 80, 69], [97, 96, 111, 70], [111, 112, 97, 70], [99, 98, 113, 71], [113, 114, 99, 71], [100, 97, 112, 72], [112, 115, 100, 72], [99, 114, 111, 73], [111, 96, 99, 73], [116, 117, 118, 74], [118, 119, 116, 74], [120, 121, 122, 75], [122, 123, 120, 75], [124, 116, 119, 76], [119, 125, 124, 76], [117, 126, 127, 77], [127, 118, 117, 77], [79, 87, 108, 78], [108, 105, 79, 78], [7, 47, 58, 79], [58, 8, 7, 79], [6, 90, 44, 80], [44, 7, 6, 80], [128, 91, 88, 81], [88, 129, 128, 81], [130, 131, 89, 82], [89, 90, 130, 82], [129, 88, 89, 83], [89, 131, 129, 83], [132, 133, 6, 84], [6, 5, 132, 84], [112, 111, 81, 85], [81, 83, 112, 85], [114, 113, 86, 86], [86, 78, 114, 86], [115, 112, 83, 87], [83, 82, 115, 87], [114, 78, 81, 88], [81, 111, 114, 88], [14, 25, 28, 89], [28, 16, 14, 89], [14, 11, 31, 90], [31, 25, 14, 90], [33, 4, 3, 91], [3, 34, 33, 91], [11, 10, 32, 92], [32, 31, 11, 92], [92, 94, 95, 93], [95, 93, 92, 93], [120, 21, 24, 94], [24, 121, 120, 94], [124, 20, 19, 95], [19, 116, 124, 95], [116, 19, 17, 96], [17, 117, 116, 96], [117, 17, 18, 97], [18, 126, 117, 97], [126, 18, 21, 98], [21, 120, 126, 98], [16, 28, 4, 99], [4, 33, 16, 99], [134, 115, 82, 100], [82, 135, 134, 100], [126, 120, 123, 101], [123, 127, 126, 101], [136, 100, 115, 102], [115, 134, 136, 102], [137, 110, 133, 103], [133, 132, 137, 103], [138, 85, 107, 104], [107, 139, 138, 104], [140, 37, 100, 105], [100, 136, 140, 105], [135, 82, 85, 106], [85, 138, 135, 106], [2, 1, 37, 107], [37, 140, 2, 107], [15, 16, 33, 108], [33, 22, 15, 108], [18, 15, 22, 109], [22, 21, 18, 109], [27, 1, 4, 110], [4, 28, 27, 110], [133, 130, 90, 111], [90, 6, 133, 111], [139, 107, 110, 112], [110, 137, 139, 112], [130, 133, 110, 113], [110, 102, 130, 113], [129, 106, 109, 114], [109, 128, 129, 114], [131, 101, 106, 115], [106, 129, 131, 115], [131, 130, 102, 116], [102, 101, 131, 116], [141, 142, 3, 117], [3, 2, 141, 117], [5, 8, 143, 2], [143, 144, 5, 2], [9, 145, 146, 118], [146, 10, 9, 118], [147, 148, 146, 119], [146, 145, 147, 119], [149, 150, 148, 120], [148, 147, 149, 120], [151, 152, 149, 121], [149, 147, 151, 121], [153, 151, 147, 122], [147, 145, 153, 122], [20, 153, 145, 123], [145, 9, 20, 123], [154, 24, 23, 124], [23, 155, 154, 124], [156, 157, 158, 125], [158, 159, 156, 125], [29, 32, 160, 126], [160, 161, 29, 126], [155, 23, 34, 127], [34, 162, 155, 127], [161, 160, 156, 128], [156, 159, 161, 128], [158, 163, 164, 129], [164, 159, 158, 129], [141, 165, 163, 130], [163, 158, 141, 130], [161, 166, 38, 131], [38, 29, 161, 131], [161, 159, 164, 132], [164, 166, 161, 132], [40, 167, 168, 133], [168, 41, 40, 133], [169, 170, 171, 134], [171, 172, 169, 134], [167, 172, 171, 135], [171, 168, 167, 135], [48, 173, 174, 136], [174, 49, 48, 136], [175, 176, 177, 137], [177, 178, 175, 137], [173, 178, 177, 138], [177, 174, 173, 138], [170, 58, 57, 139], [57, 179, 170, 139], [181, 63, 62, 141], [62, 182, 181, 141], [183, 184, 185, 142], [185, 186, 183, 142], [187, 188, 189, 143], [189, 181, 187, 143], [186, 185, 189, 144], [189, 188, 186, 144], [190, 74, 73, 145], [73, 191, 190, 145], [181, 189, 75, 146], [75, 63, 181, 146], [185, 76, 75, 147], [75, 189, 185, 147], [184, 77, 76, 148], [76, 185, 184, 148], [192, 193, 194, 149], [194, 195, 192, 149], [196, 197, 198, 150], [198, 199, 196, 150], [192, 195, 87, 151], [87, 86, 192, 151], [199, 198, 194, 152], [194, 193, 199, 152], [168, 171, 178, 153], [178, 173, 168, 153], [170, 175, 178, 154], [178, 171, 170, 154], [41, 168, 173, 155], [173, 48, 41, 155], [200, 201, 172, 156], [172, 167, 200, 156], [202, 169, 172, 157], [172, 201, 202, 157], [91, 200, 167, 158], [167, 40, 91, 158], [49, 174, 203, 159], [203, 204, 49, 159], [49, 204, 205, 161], [205, 62, 49, 161], [187, 182, 206, 162], [206, 203, 187, 162], [182, 62, 205, 163], [205, 206, 182, 163], [179, 57, 74, 165], [74, 190, 179, 165], [176, 186, 188, 166], [188, 177, 176, 166], [174, 177, 188, 167], [188, 187, 174, 167], [180, 183, 186, 168], [186, 176, 180, 168], [179, 190, 183, 169], [183, 180, 179, 169], [191, 73, 77, 170], [77, 184, 191, 170], [190, 191, 184, 171], [184, 183, 190, 171], [170, 179, 180, 172], [180, 175, 170, 172], [163, 207, 208, 174], [208, 164, 163, 174], [166, 209, 98, 175], [98, 38, 166, 175], [165, 210, 207, 176], [207, 163, 165, 176], [166, 164, 208, 177], [208, 209, 166, 177], [211, 212, 213, 178], [213, 214, 211, 178], [211, 215, 216, 179], [216, 212, 211, 179], [197, 217, 213, 180], [213, 198, 197, 180], [215, 109, 108, 181], [108, 216, 215, 181], [214, 213, 217, 182], [217, 218, 214, 182], [198, 213, 212, 183], [212, 194, 198, 183], [194, 212, 216, 184], [216, 195, 194, 184], [207, 219, 220, 185], [220, 208, 207, 185], [209, 221, 113, 186], [113, 98, 209, 186], [210, 222, 219, 187], [219, 207, 210, 187], [209, 208, 220, 188], [220, 221, 209, 188], [223, 224, 225, 189], [225, 226, 223, 189], [227, 228, 122, 190], [122, 121, 227, 190], [124, 125, 224, 191], [224, 223, 124, 191], [226, 225, 229, 192], [229, 230, 226, 192], [195, 216, 108, 193], [108, 87, 195, 193], [143, 8, 58, 194], [58, 170, 143, 194], [144, 143, 169, 195], [169, 202, 144, 195], [128, 231, 200, 196], [200, 91, 128, 196], [232, 202, 201, 197], [201, 233, 232, 197], [231, 233, 201, 198], [201, 200, 231, 198], [132, 5, 144, 199], [144, 234, 132, 199], [219, 199, 193, 200], [193, 220, 219, 200], [221, 192, 86, 201], [86, 113, 221, 201], [222, 196, 199, 202], [199, 219, 222, 202], [221, 220, 193, 203], [193, 192, 221, 203], [148, 150, 157, 204], [157, 156, 148, 204], [148, 156, 160, 205], [160, 146, 148, 205], [162, 34, 3, 206], [3, 142, 162, 206], [146, 160, 32, 207], [32, 10, 146, 207], [204, 203, 206, 208], [206, 205, 204, 208], [227, 121, 24, 209], [24, 154, 227, 209], [124, 223, 153, 210], [153, 20, 124, 210], [223, 226, 151, 211], [151, 153, 223, 211], [226, 230, 152, 212], [152, 151, 226, 212], [230, 227, 154, 213], [154, 152, 230, 213], [150, 162, 142, 214], [142, 157, 150, 214], [134, 135, 196, 215], [196, 222, 134, 215], [230, 229, 228, 216], [228, 227, 230, 216], [136, 134, 222, 217], [222, 210, 136, 217], [137, 132, 234, 218], [234, 218, 137, 218], [138, 139, 217, 219], [217, 197, 138, 219], [140, 136, 210, 220], [210, 165, 140, 220], [135, 138, 197, 221], [197, 196, 135, 221], [2, 140, 165, 222], [165, 141, 2, 222], [149, 155, 162, 223], [162, 150, 149, 223], [152, 154, 155, 224], [155, 149, 152, 224], [158, 157, 142, 225], [142, 141, 158, 225], [234, 144, 202, 226], [202, 232, 234, 226], [139, 137, 218, 227], [218, 217, 139, 227], [232, 214, 218, 228], [218, 234, 232, 228], [231, 128, 109, 229], [109, 215, 231, 229], [233, 231, 215, 230], [215, 211, 233, 230], [233, 211, 214, 231], [214, 232, 233, 231]]

let mergedfaces = []
for (let fj of faces) {
  mergedfaces.push([fj])
  for (let fi = 0; fi < mergedfaces.length-1; fi++) {
    let f = mergedfaces[fi][0]
    if (f[3] == fj[3] && (
      f.slice(0, 3).map(x => fj.slice(0, 3).includes(x)).reduce((a, b) => a+b) == 2
    )) {
      mergedfaces[fi].push(fj)
      mergedfaces.pop()
      break
    }
  }
}

verts = verts
  .map(x => [x[0]*Math.cos(ty) + x[2]*Math.sin(ty), -x[1], x[0]*-Math.sin(ty) + x[2]*Math.cos(ty)])
  .map(x => [x[0], x[1] + 150, x[2] - 210*f])
norms = norms
  .map(x => [x[0]*Math.cos(ty) + x[2]*Math.sin(ty), -x[1], x[0]*-Math.sin(ty) + x[2]*Math.cos(ty)])
  .map(x => x.map(y => y * (normal_inversion ? -1 : 1))) // normals may be inverted
faces = mergedfaces
  .map(facegroup => facegroup
    .map(x => [verts[x[0]-1], verts[x[1]-1], verts[x[2]-1], norms[x[3]-1]])
  ).filter(x => x[0][0][0]*x[0][3][0] + x[0][0][1]*x[0][3][1] + x[0][0][2]*x[0][3][2] > 0)
  .toSorted(sortbycentroid)
  .map(facegroup => facegroup
    .map(x => [x.map(y => [
      y[0]/y[2]*f,
      y[1]/y[2]*f,
    ]), 1-Math.max(0, (x[3][0]*light[0] + x[3][1]*light[1] + x[3][2]*light[2])/Math.pow(x[3][0]*x[3][0] + x[3][1]*x[3][1] + x[3][2]*x[3][2], 0.5)/Math.pow(light[0]*light[0] + light[1]*light[1] + light[2]*light[2], 0.5))])
    .map(x => [x[0].map(y => [(y[0]*0.5 + 0.5)*width, (y[1]*0.5 + 0.5)*height, y[3]], 0.5), x[1]])
    .map(x => [new bt.Turtle()
      .down()
      .jump(x[0][0])
      .goTo(x[0][1])
      .goTo(x[0][2])
      .goTo(x[0][0])
      .lines(), x[1]]
    )
    .reduce((a, b) => [bt.union(a[0],b[0]), b[1]], [new bt.Turtle().lines(), 0])
  )

// drawLines(bt.cut(generateStippling(0.5), [[[0, 0], [0, 125], [125, 0]]]))

for (let fi = 0; fi < faces.length; fi++) {
  console.log(fi/faces.length)
  let line = faces[fi][0]
  let shading = faces[fi][1]
  for (let fj = 0; fj < fi; fj++) {
    line = bt.difference(line, faces[fj][0])
  }
  drawLines(bt.cut(useHatching ? generateHatching(shading) : generateStippling(shading), line))
}

function sortbycentroid(x, y) {
  return x.reduce((a, b) => {
    let aavg = a.reduce((u, v) => [u[0] + v[0], u[1] + v[1], u[2] + v[2]]).map(z => z/3)
    let bavg = b.reduce((u, v) => [u[0] + v[0], u[1] + v[1], u[2] + v[2]]).map(z => z/3)
    return [aavg[0] + bavg[0], aavg[1] + bavg[1], aavg[2] + bavg[2]]
  })
  .map(z => Math.pow(z/x.length, 2))
  .reduce((a, b) => a + b)
  -
  y.reduce((a, b) => {
    let aavg = a.reduce((u, v) => [u[0] + v[0], u[1] + v[1], u[2] + v[2]]).map(z => z/3)
    let bavg = b.reduce((u, v) => [u[0] + v[0], u[1] + v[1], u[2] + v[2]]).map(z => z/3)
    return [aavg[0] + bavg[0], aavg[1] + bavg[1], aavg[2] + bavg[2]]
  })
  .map(z => Math.pow(z/y.length, 2))
  .reduce((a, b) => a + b)

}

function generateHatching(n) {
  let turtle = new bt.Turtle().down().right(45)
  if (hatchingLinesUp) n = Math.pow(2, Math.round(Math.log2(n*14)))/14
  for (let x = -125; x < 125; x += 0.25/n) {
    turtle = turtle
      .jump([x, 125])
      .forward(125*1.5)
  }
  return turtle.lines()
}

function generateStippling(n) {
  let turtle = new bt.Turtle().down()
  for (let x = -1; x < 125/Math.cos(Math.PI/6); x += 0.25/n) {
    for (let y = -100; y < 150; y += 0.5/n) {
      turtle = turtle
        .jump([x*Math.cos(Math.PI/6) - 0.125, x*Math.cos(Math.PI/3) + y*Math.sin(Math.PI/3)])
        .forward(0.25)
    }
  }
  return turtle.lines()
}
